dashboard_namespace: custom-dashboards
exporter_namespace: custom-exporters

openshift_cluster_content:
  - galaxy_requirements: 
      - "{{ inventory_dir }}/../mdt-secret-discovery-requirements.yml"
  - object: MDT Prometheus
    pre_steps:
      - role: mdt-quickstart/secret-discovery
    content:
      - name: MDT Prometheus htpasswd secret
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-htpasswd-secret.yml.j2"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
      - name: MDT Prometheus operator
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-operator-config.yml.j2"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
      - name: MDT Scrape config secret
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-scrape-config-secret.yml.j2"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
      - name: MDT Prometheus CR
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-cr.yml"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
      - name: MDT Prometheus Service
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-svc.yml"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
      - name: MDT Prometheus Route
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-route.yml"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
      - name: MDT Prometheus Oauth Cluster Role
        file: "{{ inventory_dir}}/../federated-prometheus/prometheus-oauth-cluster-role.yml"
        tags:
          - dashboard-sdm
      - name: MDT Prometheus Oauth Service Account
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-sa.yml"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard sdm
      - name: MDT Prometheus Oauth ClusterRoleBinding
        file: "{{ inventory_dir }}/../federated-prometheus/prometheus-oauth-cluster-role-binding.yml.j2"
        tags:
          - dashboard-sdm
      - name: MDT Repoint Grafana Datasource
        file: "{{ inventory_dir }}/../federated-prometheus/grafana-mdt-datasources.yml.j2"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
  - object: Dashboards - DevOps
    content:
      - name: Software Delivery Metrics Dashboard
        file: "{{ inventory_dir }}/../dashboard-sdm.yml"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
      - name: Mount Software Delivery Dashboard to Grafana
        action: patch
        file: "{{ inventory_dir }}/../grafana-deployment.yml"
        params: "{{ inventory_dir }}/../sdm-volume-patch.yml"
        namespace: "{{ dashboard_namespace }}"
        tags:
          - dashboard-sdm
  - object: Metrics Exporters
    content:
      - name: Exporters Namespace
        file: "{{ inventory_dir }}/../exporters-yaml/namespace.yaml.j2"
        tags:
          - exporters
      - name: Commit Time Exporter
        file: "{{ inventory_dir }}/../exporters-yaml/exporter.yaml.j2"
        namespace: "{{ exporter_namespace }}"
        jinja_vars:
          app_name: commit-time-exporter
          source_context_dir: metrics-exporters/commit-time-exporter
          source_ref: master
          source_url: https://github.com/redhat-cop/mdt-quickstart.git
          env_secret_name: github-secret
        tags:
          - exporters
      - name: Lead Time Exporter Service Account
        file: "{{ inventory_dir }}/../exporters-yaml/sa.yaml"
        namespace: "{{ exporter_namespace }}"
        tags:
          - exporters
      - name: Lead Time Exporter Role Binding
        file: "{{ inventory_dir }}/../exporters-yaml/rolebinding.yaml"
        namespace: "{{ exporter_namespace }}"
        tags:
          - exporters
      - name: Lead Time Exporter
        file: "{{ inventory_dir }}/../exporters-yaml/exporter.yaml.j2"
        namespace: "{{ exporter_namespace }}"
        jinja_vars:
          app_name: leadtime-exporter
          source_context_dir: metrics-exporters/leadtime-exporter
          source_ref: master
          source_url: https://github.com/redhat-cop/mdt-quickstart.git
          env_secret_name: github-secret
          service_account: robot
        tags:
          - exporters
