name: Pelorus Exporter Build

on:
  push:
    branches:
      - master
    paths:
      - 'exporters/**'
      - '.github/workflows/build-pelorus.yml'

env:
  builder_image: 'registry.access.redhat.com/ubi8/python-39'
  imageregistry: 'quay.io'
  # Use 'pelorus' for release
  imagenamespace: ${{ secrets.QUAY_IMAGE_NAMESPACE }}
  s2i_log_level: 2

jobs:
  build-and-push-committime-image:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build and push committime exporter
        uses: "./.github/workflow_templates/build_push_exporters"
        with:
          image: 'pelorus-committime-exporter'
          builder_image: ${{ env.builder_image }}
          s2i_log_level: ${{ env.s2i_log_level }}
          quay_imageregistry: ${{ env.imageregistry }}
          quay_imagenamespace: ${{ secrets.QUAY_IMAGE_NAMESPACE }}
          quay_username: ${{ secrets.QUAY_USERNAME }}
          quay_password: ${{ secrets.QUAY_PASSWORD }}


  build-and-push-deploytime-image:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build and push deploytime exporter
        uses: "./.github/workflow_templates/build_push_exporters"
        with:
          image: 'pelorus-deploytime-exporter'
          builder_image: ${{ env.builder_image }}
          s2i_log_level: ${{ env.s2i_log_level }}
          quay_imageregistry: ${{ env.imageregistry }}
          quay_imagenamespace: ${{ secrets.QUAY_IMAGE_NAMESPACE }}
          quay_username: ${{ secrets.QUAY_USERNAME }}
          quay_password: ${{ secrets.QUAY_PASSWORD }}


  build-and-push-failure-image:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build and push failure exporter
        uses: "./.github/workflow_templates/build_push_exporters"
        with:
          image: 'pelorus-failure-exporter'
          builder_image: ${{ env.builder_image }}
          s2i_log_level: ${{ env.s2i_log_level }}
          quay_imageregistry: ${{ env.imageregistry }}
          quay_imagenamespace: ${{ secrets.QUAY_IMAGE_NAMESPACE }}
          quay_username: ${{ secrets.QUAY_USERNAME }}
          quay_password: ${{ secrets.QUAY_PASSWORD }}


  build-and-push-releasetime-image:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build and push releasetime exporter
        uses: "./.github/workflow_templates/build_push_exporters"
        with:
          image: 'pelorus-releasetime-exporter'
          builder_image: ${{ env.builder_image }}
          s2i_log_level: ${{ env.s2i_log_level }}
          quay_imageregistry: ${{ env.imageregistry }}
          quay_imagenamespace: ${{ secrets.QUAY_IMAGE_NAMESPACE }}
          quay_username: ${{ secrets.QUAY_USERNAME }}
          quay_password: ${{ secrets.QUAY_PASSWORD }}


  build-and-push-webhook-image:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build and push webhook exporter
        uses: "./.github/workflow_templates/build_push_exporters"
        with:
          image: 'pelorus-webhook-exporter'
          builder_image: ${{ env.builder_image }}
          s2i_log_level: ${{ env.s2i_log_level }}
          quay_imageregistry: ${{ env.imageregistry }}
          quay_imagenamespace: ${{ secrets.QUAY_IMAGE_NAMESPACE }}
          quay_username: ${{ secrets.QUAY_USERNAME }}
          quay_password: ${{ secrets.QUAY_PASSWORD }}

